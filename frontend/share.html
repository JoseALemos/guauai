<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GuauAI â€” AnÃ¡lisis compartido</title>
  <meta name="description" content="AnÃ¡lisis de vocalizaciÃ³n canina con IA â€” GuauAI"/>
  <meta property="og:title" content="GuauAI ğŸ¾"/>
  <meta property="og:description" id="ogDesc" content="Mira lo que dijo mi perro"/>
  <meta property="og:image" content="https://guauai.ainertia.io/icon-512.png"/>
  <meta name="theme-color" content="#7c3aed"/>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#0a0a0f;color:#f1f5f9;font-family:system-ui,sans-serif;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem}
    .card{background:#111118;border:1px solid #1e1e30;border-radius:1.5rem;padding:2rem;max-width:480px;width:100%;text-align:center}
    .logo{font-size:1.25rem;font-weight:800;color:#a855f7;margin-bottom:1.5rem}
    .dog-info{color:#64748b;font-size:.9rem;margin-bottom:1.5rem}
    .emoji{font-size:5rem;margin-bottom:.75rem;display:block}
    .emotion{font-size:1.75rem;font-weight:900;margin-bottom:.5rem}
    .badge{display:inline-block;padding:.3rem .9rem;border-radius:9999px;font-size:.8rem;font-weight:700;margin-bottom:1.25rem}
    .message{font-size:1.2rem;font-style:italic;line-height:1.6;margin-bottom:1.5rem;color:#e2e8f0}
    .divider{height:1px;background:#1e1e30;margin:1.25rem 0}
    .row{display:flex;justify-content:space-between;padding:.5rem 0;font-size:.9rem}
    .row span:first-child{color:#64748b}
    .row span:last-child{font-weight:600}
    .rec{background:#1a1a2e;border-radius:.875rem;padding:1rem;margin-top:1.25rem;text-align:left}
    .rec-label{font-size:.75rem;color:#64748b;font-weight:700;text-transform:uppercase;letter-spacing:.05em;margin-bottom:.5rem}
    .rec-text{font-size:.9rem;line-height:1.5}
    .cta{margin-top:1.75rem;padding-top:1.25rem;border-top:1px solid #1e1e30}
    .cta p{color:#64748b;font-size:.875rem;margin-bottom:.875rem}
    .cta a{display:inline-block;background:#7c3aed;color:white;padding:.75rem 1.5rem;border-radius:.875rem;text-decoration:none;font-weight:700;font-size:.95rem}
    .error{color:#ef4444;font-size:1rem;padding:2rem}
    .loading{color:#64748b;font-size:1rem}
    .notes{color:#64748b;font-size:.8rem;font-style:italic;margin-top:.75rem}
  </style>
</head>
<body>
<div class="card" id="card">
  <div class="loading">ğŸ¾ Cargando anÃ¡lisisâ€¦</div>
</div>

<script>
const EMOTION_EMOJI={feliz:'ğŸ˜„',happy:'ğŸ˜„',ansioso:'ğŸ˜°',anxious:'ğŸ˜°',excitado:'ğŸ¤©',excited:'ğŸ¤©',asustado:'ğŸ˜¨',scared:'ğŸ˜¨',alerta:'ğŸ‘€',alert:'ğŸ‘€','juguetÃ³n':'ğŸ¾',playful:'ğŸ¾',dolorido:'ğŸ˜¢',painful:'ğŸ˜¢',agresivo:'âš ï¸',aggressive:'âš ï¸',tranquilo:'ğŸ˜Œ',calm:'ğŸ˜Œ',frustrado:'ğŸ˜¤',frustrated:'ğŸ˜¤'};
const EMOTION_COLOR={feliz:'#10b981',happy:'#10b981',excitado:'#f59e0b',excited:'#f59e0b',tranquilo:'#3b82f6',calm:'#3b82f6',alerta:'#f97316',alert:'#f97316',ansioso:'#ef4444',anxious:'#ef4444',asustado:'#8b5cf6',scared:'#8b5cf6',dolorido:'#ef4444',painful:'#ef4444',agresivo:'#ef4444',aggressive:'#ef4444',frustrado:'#f59e0b',frustrated:'#f59e0b','juguetÃ³n':'#10b981',playful:'#10b981'};

const id = location.pathname.split('/').pop();

fetch(`/api/share/${id}`)
  .then(r => r.ok ? r.json() : Promise.reject())
  .then(data => {
    const emoji = EMOTION_EMOJI[data.estado_emocional] || 'ğŸ¶';
    const color = EMOTION_COLOR[data.estado_emocional] || '#7c3aed';
    const conf  = Math.round((data.confianza||0)*100);
    const date  = new Date(data.created_at).toLocaleString('es',{day:'numeric',month:'long',hour:'2-digit',minute:'2-digit'});
    const dogInfo = [data.dog_name, data.dog_breed].filter(Boolean).join(' Â· ');

    // Update OG meta
    document.getElementById('ogDesc').setAttribute('content',`${emoji} ${data.estado_emocional} Â· "${data.mensaje_interpretado}"`);
    document.title = `GuauAI â€” ${data.dog_name||'Mi perro'} dice: ${data.estado_emocional}`;

    document.getElementById('card').innerHTML = `
      <div class="logo">ğŸ¾ GuauAI</div>
      ${dogInfo ? `<div class="dog-info">ğŸ¶ ${dogInfo} Â· ${date}</div>` : `<div class="dog-info">${date}</div>`}
      <span class="emoji">${emoji}</span>
      <div class="emotion" style="color:${color}">${data.estado_emocional?.toUpperCase()}</div>
      <span class="badge" style="background:${color}22;color:${color}">${data.tipo_vocalizacion||'vocalizaciÃ³n'} Â· ${data.intensidad||''} Â· ${conf}% confianza</span>
      <p class="message">"${data.mensaje_interpretado}"</p>
      <div class="divider"></div>
      <div class="row"><span>Necesidad</span><span>${data.necesidad||'â€”'}</span></div>
      ${data.notas_tecnicas ? `<p class="notes">ğŸ”¬ ${data.notas_tecnicas}</p>` : ''}
      ${data.recomendacion_dueno ? `<div class="rec"><div class="rec-label">ğŸ’¡ RecomendaciÃ³n</div><div class="rec-text">${data.recomendacion_dueno}</div></div>` : ''}
      <div class="cta">
        <p>Â¿Quieres saber quÃ© dice tu perro?</p>
        <a href="/">Analizar mi perro gratis â†’</a>
      </div>
            <div class="share-btns" style="margin-top:1rem;display:flex;gap:.75rem;justify-content:center;flex-wrap:wrap">
              <a id="shareWA" href="#" target="_blank" rel="noopener"
                 style="display:inline-flex;align-items:center;gap:.5rem;background:#25d366;color:#fff;padding:.6rem 1.25rem;border-radius:.875rem;font-weight:700;font-size:.875rem;text-decoration:none">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                WhatsApp
              </a>
              <a id="shareX" href="#" target="_blank" rel="noopener"
                 style="display:inline-flex;align-items:center;gap:.5rem;background:#000;color:#fff;padding:.6rem 1.25rem;border-radius:.875rem;font-weight:700;font-size:.875rem;text-decoration:none">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.744l7.73-8.835L1.254 2.25H8.08l4.253 5.622zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                X (Twitter)
              </a>
              <a id="copyLink" href="#" onclick="copyShareLink(event)"
                 style="display:inline-flex;align-items:center;gap:.5rem;background:#1e1e30;color:#a855f7;border:1px solid #a855f7;padding:.6rem 1.25rem;border-radius:.875rem;font-weight:700;font-size:.875rem;text-decoration:none">
                ğŸ”— Copiar enlace
              </a>
            </div>`;
  setShareLinks(data.estado_emocional, data.mensaje_interpretado, data.dog_name);
  })
  .catch(() => {
    document.getElementById('card').innerHTML = '<div class="error">âŒ AnÃ¡lisis no encontrado o expirado</div>';
  });

// â”€â”€ Compartir â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setShareLinks(emotion, message, dogName) {
  const url = encodeURIComponent(location.href);
  const dog = dogName ? `${dogName} ` : '';
  const text = encodeURIComponent(`ğŸ¾ ${dog}dice: "${message}" (${emotion}) â€” analizado con GuauAI`);
  const waEl = document.getElementById('shareWA');
  const xEl  = document.getElementById('shareX');
  if (waEl) waEl.href = `https://wa.me/?text=${text}%20${url}`;
  if (xEl)  xEl.href  = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
}
window.copyShareLink = function(e) {
  e.preventDefault();
  navigator.clipboard.writeText(location.href).then(() => {
    const el = document.getElementById('copyLink');
    if (el) { el.textContent = 'âœ… Copiado'; setTimeout(() => { el.innerHTML = 'ğŸ”— Copiar enlace'; }, 2000); }
  });
};
</script>
</body>
</html>
